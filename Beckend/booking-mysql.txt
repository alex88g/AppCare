-- üîó Connect to the Database
-- To connect the backend to your MySQL database, create a .env file in the Backend folder with your own credentials:
-- DB_HOST=localhost
-- DB_USER=root
-- DB_PASSWORD=your_password_here
-- DB_NAME=booking_db
-- Replace your_password_here with your actual MySQL root password...


-- üõ†Ô∏è Skapa databas
CREATE DATABASE IF NOT EXISTS booking_db;
USE booking_db;

-- üë§ Patients-tabell
CREATE TABLE IF NOT EXISTS Patients (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  phone VARCHAR(20) NOT NULL UNIQUE,
  ssn VARCHAR(20) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE
);

-- üë®‚Äç‚öïÔ∏è Doctors-tabell
CREATE TABLE IF NOT EXISTS Doctors (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  phone VARCHAR(20),
  ssn VARCHAR(12),
  code VARCHAR(10) NOT NULL UNIQUE
);

-- üìÖ Bookings-tabell
CREATE TABLE IF NOT EXISTS Bookings (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  date DATE NOT NULL,
  time VARCHAR(10) NOT NULL,
  meetingLink TEXT NOT NULL,
  patient_id BIGINT NOT NULL,
  FOREIGN KEY (patient_id) REFERENCES Patients(id) ON DELETE CASCADE
);

-- üîê OTP-tabell
CREATE TABLE IF NOT EXISTS OTPs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  phone VARCHAR(20) NOT NULL UNIQUE,
  code VARCHAR(10) NOT NULL,
  expires_at DATETIME NOT NULL
);

-- Test & Verktygskoder

-- üë®‚Äç‚öïÔ∏è Dummy-l√§kare
INSERT INTO Doctors (name, phone, ssn, code)
VALUES ('Dr. Admin', '0700000000', '190001019999', '123456')
ON DUPLICATE KEY UPDATE code = '123456';

-- üßπ Rensa gamla OTP:er som har fel format
DELETE FROM OTPs WHERE phone NOT LIKE '+46%';

-- üîç Testa olika selekteringar
SELECT * FROM OTPs ORDER BY id DESC;
SELECT * FROM Patients;
SELECT * FROM Patients WHERE phone LIKE '%3455133';
SELECT * FROM Patients WHERE ssn = '198812219759';

-- üîç Visa bokningar med patientinfo
SELECT
  b.id, b.date, b.time, b.meetingLink,
  p.name, p.phone, p.email
FROM Bookings b
JOIN Patients p ON b.patient_id = p.id;

-- üîÑ Konvertera telefonnummer till +46-format (en g√•ng)
UPDATE Patients
SET phone = CONCAT('+46', SUBSTRING(phone, 2))
WHERE phone LIKE '07%';

-- üìå Kontrollera koppling till bokningar innan DELETE
SELECT * FROM Bookings WHERE patient_id = (
  SELECT id FROM Patients WHERE phone = '+46703455133'
);

-- üß™ S√§tt in testperson
INSERT INTO Patients (name, phone, ssn, email)
VALUES ('Testperson', '+46703455133', '199001019999', 'test@example.com');

-- üßΩ Ta bort testanv√§ndare
DELETE FROM Patients WHERE phone = '+46703455133';
DELETE FROM OTPs WHERE phone = '+46703455133';
